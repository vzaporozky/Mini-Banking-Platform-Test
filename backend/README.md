# Mini Bank Platform - Backend

Бэкенд для мини-банковской платформы, реализующий double-entry ledger систему
для финансовых транзакций.

## Технологии

- **Node.js** с **NestJS** фреймворком
- **PostgreSQL** база данных
- **TypeORM** для работы с базой данных
- **JWT** аутентификация
- **Docker** для контейнеризации

## Структура базы данных

### Таблицы:

- `users` - информация о пользователях
- `accounts` - валютные аккаунты пользователей (USD, EUR)
- `transactions` - записи о транзакциях
- `ledger` - double-entry ledger записи для аудита

### Double-Entry Ledger

Каждая транзакция создает сбалансированные записи в ledger:

- **DEBIT** (отрицательная сумма) - списание с аккаунта
- **CREDIT** (положительная сумма) - зачисление на аккаунт
- Сумма всех записей для одной транзакции всегда равна нулю

## API Endpoints

### Аутентификация

- `POST /auth/login` - вход в систему
- `GET /auth/me` - получение информации о текущем пользователе

### Аккаунты

- `GET /accounts` - список аккаунтов пользователя
- `GET /accounts/:id/balance` - баланс конкретного аккаунта

### Транзакции

- `POST /transactions/transfer` - перевод между пользователями
- `POST /transactions/exchange` - обмен валют
- `GET /transactions` - история транзакций с фильтрацией

## Предустановленные пользователи

Система создает 3 тестовых пользователя при инициализации:

| Username | Password  | USD Balance | EUR Balance |
| -------- | --------- | ----------- | ----------- |
| user1    | password1 | $1000.00    | €500.00     |
| user2    | password2 | $1000.00    | €500.00     |
| user3    | password3 | $1000.00    | €500.00     |

## Курс обмена валют

- **1 USD = 0.92 EUR**
- **1 EUR = 1.09 USD** (обратный курс)

## Запуск приложения

### Локальная разработка

1. **Установка зависимостей:**

```bash
npm install
```

2. **Настройка базы данных:**

```bash
# Создайте .env файл на основе .env.example
cp .env.example .env

# Запустите PostgreSQL локально или через Docker
docker run --name postgres -e POSTGRES_PASSWORD=password -e POSTGRES_DB=mini_bank -p 5432:5432 -d postgres:latest
```

3. **Запуск миграций:**

```bash
npm run migration:run
```

4. **Заполнение тестовыми данными:**

```bash
npm run seed
```

5. **Запуск в режиме разработки:**

```bash
npm run start:dev
```

### Docker

1. **Запуск через docker-compose:**

```bash
docker-compose up --build
```

2. **Приложение будет доступно по адресу:**

- Backend: http://localhost:3000
- PostgreSQL: localhost:5432

## Скрипты

- `npm run build` - сборка проекта
- `npm run start` - запуск в продакшене
- `npm run start:dev` - запуск в режиме разработки
- `npm run migration:run` - выполнение миграций
- `npm run migration:revert` - откат миграций
- `npm run seed` - заполнение тестовыми данными

## Безопасность

- Пароли хешируются с помощью bcrypt
- JWT токены с истечением через 24 часа
- Валидация входных данных
- Транзакционная целостность для всех финансовых операций

## Архитектурные решения

1. **Double-Entry Ledger** - обеспечивает полную аудируемость всех финансовых
   операций
2. **Транзакции базы данных** - гарантируют целостность данных при конкурентных
   операциях
3. **Разделение ответственности** - четкое разделение между контроллерами,
   сервисами и сущностями
4. **Валидация** - проверка всех входных данных и бизнес-правил
